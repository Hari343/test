<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hub9 test</title>
	<!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
	<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
</head>
<body>
	          <div class="col-12 col-lg-6 enquiry_form-parent">
            <div class="stickey_menu">
            
              <div class="stickey_content enquiry_form">
              
              <div class="form-header">
                <h5>HUB9</h5>
                <h2>Catalyst by HUB9</h2>
                <h6>148, Fife Road, Colombo - 05.</h6>
                <hr>
              </div>

              <div data-bind="visible: !formActive()" style=" border-radius: 5px; background-color: #fcfcfa; padding: 20px; margin-bottom: 90px; margin-top: 90px;   text-align: center; "> <h6>Thanks! We can't wait to meet you.</h6><h6>You'll be receiving a tour confirmation e-mail momentarily!</h6></div>
              <form id="frm" class="row" data-bind="visible: formActive">

                <div class="form-group col-12" data-bind="visible: !visibility()">
                  <label for="">Full name</label>
                  <div>
                    <input type="text" name="name" id="" placeholder="Your full name" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 1" class="normally-hidden">* Please fill this field</h6>
                </div>

                <!-- form frame 2 element-->
                <div class="form-group col-6" data-bind="visible: visibility">
                  <label for="">Date</label>
                  <div>
                    <input type="date" name="name" id="" placeholder="01/01/2000" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 6" class="normally-hidden">* Please fill this field</h6>
                </div>

                <div class="form-group col-12" data-bind="visible: !visibility()">
                  <label for="">Email address</label>
                  <div>
                    <input type="text" name="email" id="" placeholder="Your email address" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 2" class="normally-hidden">* Please fill this field</h6>
                </div>

                <!-- form frame 2 element-->
                <div class="form-group col-6" data-bind="visible: visibility">
                  <label for="">Time</label>
                  <div>
                    <input type="time" name="name" id="" placeholder="00:00" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 7" class="normally-hidden">* Please fill this field</h6>
                </div>

                <div class="form-group col-12" data-bind="visible: !visibility()">
                  <label for="">Phone number</label>
                  <div>
                    <input type="text" name="phone" id="" placeholder="Your phone number" class="form-control form-control-warning">
                  </div>
                  <h6 data-bind="visible: code() == 3" class="normally-hidden">* Please fill this field</h6>
                </div>

                <!-- form frame 2 element-->
                <div class="form-group col-6" data-bind="visible: visibility">
                  <label for="">Company Name</label>
                  <div>
                    <input type="text" name="company_name" id="" placeholder="Name of your company" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 8" class="normally-hidden">* Please fill this field</h6>
                </div>

                <div class="form-group col-6" data-bind="visible: !visibility()">
                  <label for="">When would you like to start work with us?</label>
                  <div>
                    <input type="date" value='<?php echo date("d/m/Y") ?>' placeholder="Start date" name="date" id="" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 4" class="normally-hidden">* Please fill this field</h6>
                </div>

                <!-- form frame 2 element-->
                <div class="form-group col-6" data-bind="visible: visibility">
                  <label for="">Promo Code</label>
                  <div>
                    <input type="text" name="promo" id="" placeholder="AAP123" class="form-control">
                  </div>
                  <h6 data-bind="visible: code() == 9" class="normally-hidden">* Please fill this field</h6>
                </div>

                <div class="form-group col-6" data-bind="visible: !visibility()">
                  <label for=""></br>Number of team mates</label>
                  <div>
                    <input type="number" value="1" name="persons" id="" placeholder="How many people" class="form-control form-control-warning">
                  </div>
                  <h6 data-bind="visible: code() == 5" class="normally-hidden">* Please fill this field</h6>
                </div>

                <!-- form frame 2 element-->
                <div class="form-group col-12" data-bind="visible: visibility">
                  <label for="">Notes</label>
                  <div>
                    <textarea type="text" name="notes" id="" placeholder="Notes" class="form-control"></textarea>
                  </div>
                  <h6 data-bind="visible: code() == 10" class="normally-hidden">* Please fill this field</h6>
                </div>


                <div class="form-group col-12">

                  <input type="hidden" name="to_mail" value="sameera@hub9.space">

                  <input data-bind="attr: { value: caption }, click: launch" type="submit" class="w-100 btn btn-warning text-center">
                </div>

              </form>

              <div class="form-footer">
                <h6 style="font-size: 12px;">*Please note that you are only entitled to a free day pass for one person. </h6>
                <h6 data-bind="visible: formActive">Schedule a visit above. Or call us at: <a href="tel:+94777292950"> +94 77 729 2950 </a> </h6>
              </div>

              </div>

            </div>
          </div>
    <script type="text/javascript" src="knockout-3.4.2.js"></script>
    <script type="text/javascript">
      //form validation function
      function validateForm() {
        let j = 0, k = 0;
        for (let i = 0; i < 5; i++) { 
          if(myVM.visibility() == false) {
            j = i * 2;
            console.log("validateForm visibility false condition running...");
            if (document.forms[0].elements[j].value == "") {
              console.log("ValidateForm is executing and the i is: %d %d", i, j);
              console.log(document.forms[0].elements[i]);
              myVM.code(i+1); return 0;
            } 
          }
          else {
            k = 2 * i + 1;
            console.log("validateForm visibility true condition is running...");
            if (document.forms[0].elements[k].value == "") {
              console.log("ValidateForm is executing and the i is: %d", i, k);
              myVM.code(i+6); return 0;
            }    
          }
 
        }
        myVM.code(0);
        return 1;
      }

      // view model class
      function appViewModel() {
        this.caption = ko.observable("Book A Free Day Pass");
        this.code = ko.observable("0");
        this.formActive = ko.observable(true);
        this.visibility = ko.observable(false);
        this.launch = () => { this.caption("Processing...");
          //Form validation
          if(validateForm() == 0)
          {
            
            if(this.visibility() == false ) {
                this.caption("Book A Free Day Pass"); return 0; 
            }
            else {
                this.caption("See Time to Visit"); return 0;
            } 
    
          }
          console.log("validateForm passed!");

          //algorithm for second page
          if(this.visibility() == false) {
            console.log("visibility false condition");
            this.caption("See Time For A Visit");
            this.visibility(true); return 0;
          }

          console.log("Entering Fetch API...");

          let URL = "../mail/mail.php";
          let formData = new FormData(document.getElementById('frm'));
          fetch(URL, {body: formData, method: "POST"}).then(response => {
            
            if(response.ok) {
              console.log(response)
              return response.json();
              
            } else {
              
              return Promise.reject("something went wrong!");
            }

          }).then(data => {
            
            if(data.result == 1){

              // this.caption("Mail has been sent successfully!");
              this.formActive(false);


            }else{
              this.caption("Sorry try again!");
            }

          }).catch(error => this.caption("Failed. Please reload and try again!"))

          }

        }  

      // initialize the VM
      let myVM = new appViewModel();
      ko.applyBindings(myVM);
    </script>

</body>
</html>